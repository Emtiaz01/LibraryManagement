@model LibraryManagementSystem.ViewModel.AdminDashboardViewModel
@{
    ViewBag.Title = "Library Dashboard";
    Layout = "~/Views/Shared/_AdminPage.cshtml";
}
<link href="~/css/bs23-theme.css" rel="stylesheet" />
<link href="~/css/site - Copy.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<style>
    .bs23-insight-row {
        margin-bottom: 1.8rem;
    }

    .bs23-insight-card {
        border-radius: 14px;
        background: #fffbe0;
        box-shadow: 0 3px 16px -6px #ffd74077;
        padding: 1.3rem 1.2rem;
    }

    .bs23-insight-label {
        font-size: 1.07rem;
        font-weight: 600;
        color: #957900;
    }

    .bs23-insight-value {
        font-size: 1.6rem;
        font-weight: 900;
        letter-spacing: .08em;
    }

    .bs23-insight-trendup {
        color: #16a34a;
        font-weight: bold;
    }

    .bs23-insight-trenddown {
        color: #d32f2f;
        font-weight: bold;
    }

    .bs23-card-action {
        margin: .5rem 0 .2rem 0;
    }

    .bs23-highlight-badge {
        background: linear-gradient(90deg, #ffe082, #ffd34c 100%);
        color: #764;
        font-weight: 700;
        border-radius: 8px;
        padding: .28rem .75rem;
        margin-left: .5rem;
    }

    .bs23-member-card {
        background: #f9f7f2;
        border-radius: 10px;
        padding: .7rem 1.3rem;
        margin-bottom: .7rem;
    }

    .bs23-action-btn {
        font-weight: 700;
        font-size: 1.03rem;
        margin-right: .3rem;
    }
</style>

<div class="container-fluid px-0">
    <!-- Insights Row -->
    <div class="row bs23-insight-row">
        <div class="col-md-3">
            <div class="bs23-insight-card text-center">
                <div class="bs23-insight-label">Overdue %</div>
                <div class="bs23-insight-value">@Model.OverduePercent.ToString("0.##") %</div>
                @if (Model.OverdueTrendToday > 0)
                {
                    <span class="bs23-insight-trendup"><i class="bi bi-arrow-up"></i> +@Model.OverdueTrendToday.ToString("0.##")% today</span>
                }
                else if (Model.OverdueTrendToday < 0)
                {
                    <span class="bs23-insight-trenddown"><i class="bi bi-arrow-down"></i> @(-Model.OverdueTrendToday).ToString("0.##")% today</span>
                }
                else
                {
                    <span class="text-muted">No change</span>
                }
            </div>
        </div>
        <div class="col-md-3">
            <div class="bs23-insight-card text-center">
                <div class="bs23-insight-label">Today's Revenue</div>
                <div class="bs23-insight-value">৳@Model.TodayRevenue.ToString("0.##")</div>
                @if (Model.TodayRevenueTrend > 0)
                {
                    <span class="bs23-insight-trendup"><i class="bi bi-graph-up"></i> Up</span>
                }
                else if (Model.TodayRevenueTrend < 0)
                {
                    <span class="bs23-insight-trenddown"><i class="bi bi-graph-down"></i> Down</span>
                }
                else
                {
                    <span class="text-muted">No change</span>
                }
            </div>
        </div>
        <div class="col-md-3">
            <div class="bs23-insight-card text-center">
                <div class="bs23-insight-label">Pending Donations</div>
                <div class="bs23-insight-value">@Model.PendingDonations</div>
                <a href="@Url.Action("PendingDonations", "ProductApproval", new { area = "AdminArea" })" class="btn btn-warning bs23-action-btn my-2">Review</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="bs23-insight-card text-center">
                <div class="bs23-insight-label">High-Fine Members</div>
                <div class="bs23-insight-value">@Model.MembersWithHighFine</div>
                <a href="@Url.Action("GetUser", "Admin", new { area = "AdminArea" })" class="btn btn-danger bs23-action-btn my-2">Notify</a>
            </div>
        </div>
    </div>

    <!-- Main KPI Cards Row -->
    <div class="row row-cols-2 row-cols-md-5 g-4 mb-4">
        <div class="col">
            <div class="card text-center bs23-card">
                <div class="card-body">
                    <div class="bi bi-book text-primary"></div>
                    <div class="bs23-label">Books</div>
                    <div class="bs23-metric text-muted">@Model.TotalBooks</div>
                    <div class="bs23-card-action"><a href="@Url.Action("GetProduct", "Admin", new { area = "AdminArea" })" class="btn btn-outline-primary btn-sm">Manage</a></div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card text-center bs23-card">
                <div class="card-body">
                    <div class="bi bi-people text-success"></div>
                    <div class="bs23-label">Members</div>
                    <div class="bs23-metric text-muted">@Model.TotalMembers</div>
                    <div class="bs23-card-action"><a href="@Url.Action("GetUser", "Admin", new { area = "AdminArea" })" class="btn btn-outline-success btn-sm">View All</a></div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card text-center bs23-card">
                <div class="card-body">
                    <div class="bi bi-journal-arrow-down text-warning"></div>
                    <div class="bs23-label">Active Loans</div>
                    <div class="bs23-metric text-muted">@Model.ActiveLoans</div>
                    <div class="bs23-card-action"><a href="@Url.Action("AllBorrowedBooks", "Admin", new { area = "AdminArea" })" class="btn btn-outline-warning btn-sm">Track All</a></div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card text-center bs23-card">
                <div class="card-body">
                    <div class="bi bi-alarm text-danger"></div>
                    <div class="bs23-label">Overdue</div>
                    <div class="bs23-metric text-muted">
                        @Model.OverdueLoans
                        @if (Model.OverdueLoans > 0)
                        {
                            <span class="bs23-highlight-badge">Action Needed!</span>
                        }
                    </div>
                    <div class="bs23-card-action"><a href="@Url.Action("OverdueList", "Admin", new { area = "AdminArea" })" class="btn btn-danger btn-sm">Review</a></div>
                </div>
            </div>
        </div>
        <div class="col">
            <a href="@Url.Action("AllPayments", "Payment", new { area = "AdminArea" })" class="text-decoration-none">
                <div class="card text-center bs23-card bs23-card-highlight">
                    <div class="card-body">
                        <div class="bi bi-cash-coin"></div>
                        <div class="bs23-label">Payments</div>
                        <div class="fs-4 fw-semibold">View All</div>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card bs23-card">
                <div class="card-header fw-bold text-primary d-flex align-items-center" style="background:#eaf1fb;">
                    <i class="bi bi-bar-chart-steps me-2"></i>
                    <span>Library Stats</span>
                </div>
                <div class="card-body">
                    <div class="row gy-2">
                        <div class="col-7">Donated Books</div>
                        <div class="col-5 text-end text-muted fw-semibold">@Model.DonatedBooksCount</div>
                        <div class="col-7">Books Issued Today</div>
                        <div class="col-5 text-end text-muted fw-semibold">@Model.BooksIssuedToday</div>
                        <div class="col-7">Books Returned</div>
                        <div class="col-5 text-end text-muted fw-semibold">@Model.BooksReturnedToday</div>
                        <div class="col-7">Books Reserved</div>
                        <div class="col-5 text-end text-muted fw-semibold">@Model.BooksReserved</div>
                        <div class="col-7">New Members Joined</div>
                        <div class="col-5 text-end text-muted fw-semibold">@Model.NewMembersToday</div>
                    </div>
                    <div class="bs23-card-action mt-2">
                        <a href="#" class="btn btn-outline-secondary btn-sm"><i class="bi bi-download"></i> Export Stats</a>
                    </div>
                </div>
                @if (Model.MostOverdueMember != null)
                {
                    <div class="bs23-member-card">
                        <span class="fw-semibold"><i class="bi bi-exclamation-octagon text-danger"></i> Most Overdue Member:</span>
                        <span>@Model.MostOverdueMember.Name (@Model.MostOverdueMember.OverdueBooks) books, ৳@Model.MostOverdueMember.FineAmount.ToString("0.##")</span>
                        <a href="@Url.Action("GetUser", "Admin", new { area = "AdminArea", id = Model.MostOverdueMember.Id })"
                           class="btn btn-sm btn-outline-danger ms-2">Notify</a>
                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.MostBorrowedBook))
                {
                    <div class="bs23-member-card">
                        <span class="fw-semibold"><i class="bi bi-star-fill text-warning"></i> Most Borrowed Book:</span>
                        <span>@Model.MostBorrowedBook</span>
                    </div>
                }
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card bs23-card">
                <div class="card-header fw-bold text-primary d-flex align-items-center" style="background:#e3ecf8;">
                    <i class="bi bi-clock-history me-2"></i>
                    <span>Recent Activity</span>
                </div>
                <div class="bs23-scroll-panel">
                    <ul class="list-group list-group-flush">
                        @if (Model.RecentActivities != null && Model.RecentActivities.Count > 0)
                        {
                            foreach (var activity in Model.RecentActivities)
                            {
                                <li class="list-group-item small">@activity</li>
                            }
                        }
                        else
                        {
                            <li class="list-group-item small text-muted text-center">No recent activity to display.</li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
